"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[900],{37572:function(e,n,t){t.r(n),t.d(n,{default:function(){return c}});var r=t(27378),a=t(20951),o=t(48171);function i(e){const n=Object.assign({h1:"h1",a:"a",div:"div",h2:"h2",p:"p",ul:"ul",li:"li",strong:"strong",code:"code",h3:"h3",ol:"ol",pre:"pre",em:"em"},(0,a.ah)(),e.components);return r.createElement(r.Fragment,null,r.createElement(n.h1,{id:"implementing-a-transactional-outbox-with-asyncapi-springmodulith-and-zenwavesdk",style:{position:"relative"}},r.createElement(n.a,{href:"#implementing-a-transactional-outbox-with-asyncapi-springmodulith-and-zenwavesdk","aria-label":"implementing a transactional outbox with asyncapi springmodulith and zenwavesdk permalink",className:"anchor before"},r.createElement(n.div,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Implementing a Transactional OutBox With AsyncAPI, SpringModulith and ZenWaveSDK"),"\n",r.createElement(n.h2,{id:"introduction",style:{position:"relative"}},r.createElement(n.a,{href:"#introduction","aria-label":"introduction permalink",className:"anchor before"},r.createElement(n.div,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Introduction"),"\n",r.createElement(n.p,null,"When processes span multiple services without shared transaction boundaries, ensuring atomicity and consistency in distributed systems is challenging."),"\n",r.createElement(n.p,null,"Distributed transactions with Two-Phase Commits (2PC) are complex, introduce significant performance overhead, and may not even be feasible for certain services."),"\n",r.createElement(n.p,null,'The Outbox Pattern solves this by using a Database Transaction to store events in a dedicated "outbox" table within the same transaction as a database update. These events are then published to external systems, such as an email service or message broker, ensuring eventual consistency without the need for distributed transactions.'),"\n",r.createElement(n.p,null,"In this post, we’ll explore how we can implement a Transactional Outbox Pattern to:"),"\n",r.createElement(n.ul,null,"\n",r.createElement(n.li,null,"Persist data to a supported transactional database (e.g., SQL or MongoDB)."),"\n",r.createElement(n.li,null,"Send events to an external message broker like Kafka or RabbitMQ using Spring Cloud Stream."),"\n",r.createElement(n.li,null,"Leverage Spring Modulith Events transactional features."),"\n",r.createElement(n.li,null,"Use ZenWaveSDK Code Generator for AsyncAPI so you don’t need to write a single line of boilerplate code for the transactional outbox and event publishing."),"\n"),"\n",r.createElement(o.Ee,{dark:"TransactionalOutBoxWithAsyncAPIAndSpringModulith-dark.png",light:"TransactionalOutBoxWithAsyncAPIAndSpringModulith-light.png",alt:"Transactional OutBox With AsyncAPI SpringCloud Stream And Spring Modulith"}),"\n",r.createElement(n.h2,{id:"playground-project",style:{position:"relative"}},r.createElement(n.a,{href:"#playground-project","aria-label":"playground project permalink",className:"anchor before"},r.createElement(n.div,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Playground Project"),"\n",r.createElement(n.p,null,"Because working software is worth more than a thousand words, we’ll use a fully functional playground project that you can explore and test yourself."),"\n",r.createElement(n.p,null,"We'll use the following project as our playground: ",r.createElement(n.a,{href:"https://github.com/EDALearn/EDA-TransactionalOutbox-Modulith-JPA"},"EDA-TransactionalOutbox-Modulith-JPA"),"."),"\n",r.createElement(n.p,null,"This project provides a simple API for managing customer details, including REST endpoints for CRUD operations. These operations publish event notifications to a Kafka topic, using Avro as the payload format."),"\n",r.createElement(n.p,null,"Key components of the project include:"),"\n",r.createElement(n.ul,null,"\n",r.createElement(n.li,null,r.createElement(n.strong,null,"OpenAPI definition file"),": ",r.createElement(n.a,{href:"https://github.com/ZenWave360/zenwave-playground/blob/main/zenwave-jpa-example/src/main/resources/public/apis/openapi.yml"},"openapi.yml")),"\n",r.createElement(n.li,null,r.createElement(n.strong,null,"AsyncAPI definition file"),": ",r.createElement(n.a,{href:"https://github.com/ZenWave360/zenwave-playground/blob/main/zenwave-jpa-example/src/main/resources/public/apis/asyncapi.yml"},"asyncapi.yml")),"\n",r.createElement(n.li,null,r.createElement(n.strong,null,"Avro schemas for events"),": ",r.createElement(n.a,{href:"https://github.com/ZenWave360/zenwave-playground/tree/main/zenwave-jpa-example/src/main/resources/public/apis/avro"},"Avro schemas")),"\n"),"\n",r.createElement(n.h2,{id:"distributed-transactions-problem-and-the-outbox-pattern",style:{position:"relative"}},r.createElement(n.a,{href:"#distributed-transactions-problem-and-the-outbox-pattern","aria-label":"distributed transactions problem and the outbox pattern permalink",className:"anchor before"},r.createElement(n.div,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Distributed Transactions Problem and The Outbox Pattern"),"\n",r.createElement(o.Ee,{src:"CustomerEvents.plantuml.png"}),"\n",r.createElement(n.p,null,"When managing a ",r.createElement(n.code,null,"Customer")," entity, we encounter a significant challenge: ensuring the atomicity of persisting customer details in the database and publishing a related event to an external message broker. Since the database and the message broker do not share a transaction boundary, this can lead to potential inconsistencies."),"\n",r.createElement(n.h3,{id:"key-scenarios-highlighting-the-problem",style:{position:"relative"}},r.createElement(n.a,{href:"#key-scenarios-highlighting-the-problem","aria-label":"key scenarios highlighting the problem permalink",className:"anchor before"},r.createElement(n.div,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Key Scenarios Highlighting the Problem:"),"\n",r.createElement(n.ol,null,"\n",r.createElement(n.li,null,"\n",r.createElement(n.p,null,r.createElement(n.strong,null,"Event Sent Before Database Transaction Commits"),":\r\nIf the event is published before the database transaction is committed, a rollback of the transaction would leave the system in an inconsistent state, as the published event cannot be undone."),"\n"),"\n",r.createElement(n.li,null,"\n",r.createElement(n.p,null,r.createElement(n.strong,null,"Event Sent After Database Transaction Commits"),":\r\nIf the event is published after the database transaction is committed, there’s no guarantee the event will actually be sent. A service crash or network failure could prevent the event from being published, resulting in data inconsistency."),"\n"),"\n"),"\n",r.createElement(n.pre,null,r.createElement(n.code,{className:"language-java"},'@Service\r\npublic class CustomerService {\r\n    // ...\r\n\r\n    @Transactional\r\n    public Customer createCustomer(Customer input) {\r\n        log.debug("Request to save Customer: {}", input);\r\n        var customer = mapper.update(new Customer(), input);\r\n        customer = customerRepository.save(customer); // Persist to DB\r\n\r\n        var customerEvent = eventsMapper.asCustomerEvent(customer);\r\n        eventsProducer.onCustomerEvent(customerEvent); // Emit Event to external Broker\r\n        return customer;\r\n    }\r\n}\n')),"\n",r.createElement(n.p,null,"With the transactional outbox pattern, instead of directly sending the event to the external system, the call to ",r.createElement(n.code,null,"eventsProducer.onCustomerEvent(customerEvent)")," stores the event in a dedicated outbox table as part of the same transaction as the database update. An external process then reads from the outbox table and publishes the event to the message broker."),"\n",r.createElement(n.p,null,"However, implementing this external process, managing the outbox table, and ensuring that events are published once and in the correct order can be complex and error-prone."),"\n",r.createElement(n.p,null,"Fortunately, tools like ",r.createElement(n.a,{href:"https://docs.spring.io/spring-modulith/reference/events.html#publication-registry"},"Spring Modulith’s Event Publication Registry")," and the ",r.createElement(n.a,{href:"https://www.zenwave360.io/zenwave-sdk/plugins/asyncapi-spring-cloud-streams3/"},"ZenWaveSDK Code Generator for AsyncAPI")," simplify this process, so you can focus only on implementing your business logic."),"\n",r.createElement(n.h2,{id:"zenwavesdk-code-generation-for-asyncapi-and-spring-cloud-streams",style:{position:"relative"}},r.createElement(n.a,{href:"#zenwavesdk-code-generation-for-asyncapi-and-spring-cloud-streams","aria-label":"zenwavesdk code generation for asyncapi and spring cloud streams permalink",className:"anchor before"},r.createElement(n.div,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"ZenWaveSDK Code Generation for AsyncAPI and Spring Cloud Streams"),"\n",r.createElement(n.p,null,"ZenWaveSDK generates all the boilerplate code needed to send and receive events using Spring Cloud Stream from an AsyncAPI definition file."),"\n",r.createElement("iframe",{width:"560",height:"315",src:"https://www.youtube.com/embed/d5xddNWYR5I?si=G9MQO9afhNIw6ym2",title:"AsyncAPI: Full Code Generation for Java with ZenWave SDK",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin",allowfullscreen:!0}),"\n",r.createElement(n.p,null,"From your AsyncAPI definition file, ZenWaveSDK generates:"),"\n",r.createElement(n.ul,null,"\n",r.createElement(n.li,null,r.createElement(n.strong,null,"DTO/Models")," for your event payloads."),"\n",r.createElement(n.li,null,r.createElement(n.strong,null,"Typed Header Objects")," to ensure consistency."),"\n",r.createElement(n.li,null,r.createElement(n.strong,null,'"Intention-revealing" Java interfaces')," with methods named explicitly after your operationIds."),"\n",r.createElement(n.li,null,"A lightweight implementation using Spring Cloud Streams that can be ",r.createElement(n.code,null,"@Autowire"),"d directly into your services."),"\n"),"\n",r.createElement(n.p,null,"You can then configure Spring Cloud Stream to send and receive messages using any of the ",r.createElement(n.a,{href:"https://docs.spring.io/spring-cloud-stream/reference/index.html"},"supported binders"),", such as Kafka or RabbitMQ. With ZenWaveSDK, you don’t need to write any boilerplate code, allowing you to focus entirely on your business logic."),"\n",r.createElement("details",null,r.createElement("summary",null,"ZenWave SDK Maven Plugin Configuration"),r.createElement(n.pre,null,r.createElement(n.code,{className:"language-xml"},"  <plugin>\r\n    <groupId>io.zenwave360.sdk</groupId>\r\n    <artifactId>zenwave-sdk-maven-plugin</artifactId>\r\n    <version>${zenwave.version}</version>\r\n    <configuration>\r\n      <inputSpec>${project.basedir}/src/main/resources/public/apis/asyncapi.yml</inputSpec>\r\n      <addCompileSourceRoot>true</addCompileSourceRoot>\r\n      <addTestCompileSourceRoot>true</addTestCompileSourceRoot>\r\n    </configuration>\r\n    <executions>\r\n      \x3c!-- DTOs --\x3e\r\n      \x3c!-- we skip DTOs generation in this case b/c we are using Avro for that --\x3e\r\n\r\n      \x3c!-- Generate PROVIDER --\x3e\r\n      <execution>\r\n        <id>generate-asyncapi</id>\r\n        <phase>generate-sources</phase>\r\n        <goals>\r\n          <goal>generate</goal>\r\n        </goals>\r\n        <configuration>\r\n          <generatorName>spring-cloud-streams3</generatorName>\r\n          <configOptions>\r\n            <role>provider</role>\r\n            <style>imperative</style>\r\n            <transactionalOutbox>modulith</transactionalOutbox>\x3c!-- using Spring Modulith implementation --\x3e\r\n            <modelPackage>${asyncApiModelPackage}</modelPackage>\r\n            <producerApiPackage>${asyncApiProducerApiPackage}</producerApiPackage>\r\n            <consumerApiPackage>${asyncApiConsumerApiPackage}</consumerApiPackage>\r\n          </configOptions>\r\n        </configuration>\r\n      </execution>\r\n    </executions>\r\n    <dependencies>\r\n      // ...\r\n    </dependencies>\r\n  </plugin>\n"))),"\n",r.createElement("details",null,r.createElement("summary",null,"Avro Maven Plugin Configuration"),r.createElement(n.pre,null,r.createElement(n.code,{className:"language-xml"},"<plugin>\r\n  <groupId>org.apache.avro</groupId>\r\n  <artifactId>avro-maven-plugin</artifactId>\r\n  <version>1.11.1</version>\r\n  <executions>\r\n    <execution>\r\n      <goals>\r\n        <goal>schema</goal>\r\n      </goals>\r\n      <phase>generate-sources</phase>\r\n    </execution>\r\n  </executions>\r\n  <configuration>\r\n    <sourceDirectory>${project.basedir}/src/main/resources/public/apis/avro</sourceDirectory>\r\n    <outputDirectory>${project.basedir}/target/generated-sources/avro</outputDirectory>\r\n    <imports>\r\n      <import>${project.basedir}/src/main/resources/public/apis/avro/PaymentMethodType.avsc</import>\r\n      <import>${project.basedir}/src/main/resources/public/apis/avro/PaymentMethod.avsc</import>\r\n      <import>${project.basedir}/src/main/resources/public/apis/avro/Address.avsc</import>\r\n    </imports>\r\n  </configuration>\r\n</plugin>\n"))),"\n",r.createElement(n.p,null,"To achieve this, we configure the ",r.createElement(n.code,null,"zenwave-sdk-maven-plugin")," and, in this case, also the ",r.createElement(n.code,null,"avro-maven-plugin")," in the ",r.createElement(n.code,null,"pom.xml")," file. This setup ensures that the necessary code is generated in the ",r.createElement(n.code,null,"target/generated-sources")," folder as part of your build process."),"\n",r.createElement(n.p,null,"Since this configuration runs automatically during the build, every time you update your AsyncAPI definition file, you can be sure that your code remains in sync with your API definition."),"\n",r.createElement(o.Ee,{dark:"ZenWaveSDK-Target-Generated-Sources-With-Arrow.png",light:"ZenWaveSDK-Target-Generated-Sources-With-Arrow-light.png"}),"\n",r.createElement(n.p,null,"And because we configured the ",r.createElement(n.code,null,"transactionalOutbox")," option to ",r.createElement(n.code,null,"modulith"),", ZenWaveSDK will generate the code to use Spring Modulith Events Publication Registry to manage the transactional outbox for you."),"\n",r.createElement(o.Ee,{dark:"ZenWaveSDK-TransactionalOutBox-Modulith-With-Arrows.png",light:"ZenWaveSDK-TransactionalOutBox-Modulith-With-Arrows-light.png"}),"\n",r.createElement(n.h2,{id:"spring-modulith-events-publication-registry",style:{position:"relative"}},r.createElement(n.a,{href:"#spring-modulith-events-publication-registry","aria-label":"spring modulith events publication registry permalink",className:"anchor before"},r.createElement(n.div,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Spring Modulith Events Publication Registry"),"\n",r.createElement(n.p,null,"Because Event Externalization is enabled, and ",r.createElement(n.code,null,"Message<?>")," objects are configured for externalization (see below), these events are also stored transactionally in the Spring Modulith Event Publication Registry."),"\n",r.createElement(n.pre,null,r.createElement(n.code,{className:"language-yaml"},"spring:\r\n  modulith.events.externalization.enabled: true\r\n  modulith.events.jdbc.schema-initialization.enabled: true\r\n  modulith.events.republish-outstanding-events-on-restart: true\n")),"\n",r.createElement(o.Ee,{dark:"Modulith-Event-Publication-Registry.png",light:"Modulith-Event-Publication-Registry-light.png"}),"\n",r.createElement(n.h2,{id:"using-spring-cloud-streams-to-externalize-modulith-events",style:{position:"relative"}},r.createElement(n.a,{href:"#using-spring-cloud-streams-to-externalize-modulith-events","aria-label":"using spring cloud streams to externalize modulith events permalink",className:"anchor before"},r.createElement(n.div,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Using Spring Cloud Streams to Externalize Modulith Events"),"\n",r.createElement(n.p,null,"Now that Spring Modulith is managing our ",r.createElement(n.code,null,"Message<?>")," events, we need to configure one of the many supported ",r.createElement(n.a,{href:"https://docs.spring.io/spring-modulith/reference/events.html#externalization"},"event externalizers"),"."),"\n",r.createElement(n.p,null,"If we were publishing POJOs in JSON format, we could use ",r.createElement(n.code,null,"spring-modulith-events-kafka")," to externalize events to a Kafka topic. However, since we want to externalize ",r.createElement(n.code,null,"Message<?>")," objects with Avro payloads, we will use ",r.createElement(n.code,null,"io.zenwave360.sdk:spring-modulith-events-scs"),", which supports serializing and deserializing ",r.createElement(n.code,null,"Message<?>")," objects, with or without Avro payloads."),"\n",r.createElement(n.p,null,"For more details, see ",r.createElement(n.a,{href:"https://github.com/ZenWave360/spring-modulith-events-spring-cloud-stream"},"ZenWave360 Spring Modulith Events for Spring Cloud Stream"),"."),"\n",r.createElement(n.p,null,"To enable this, add the following dependencies to your ",r.createElement(n.code,null,"pom.xml")," file:"),"\n",r.createElement(n.pre,null,r.createElement(n.code,{className:"language-xml"},"<dependency>\x3c!-- Spring Cloud Stream Externalization for Message<?> --\x3e\r\n    <groupId>io.zenwave360.sdk</groupId>\r\n    <artifactId>spring-modulith-events-scs</artifactId>\r\n    <version>${spring-modulith-events-scs.version}</version>\r\n</dependency>\r\n<dependency>\x3c!-- Needed for serializing Avro payloads to db storage as json --\x3e\r\n    <groupId>com.fasterxml.jackson.dataformat</groupId>\r\n    <artifactId>jackson-dataformat-avro</artifactId>\r\n</dependency>\n")),"\n",r.createElement(n.p,null,"And ",r.createElement(n.code,null,"@EnableSpringCloudStreamEventExternalization")," to our Spring Boot Configuration:"),"\n",r.createElement(n.pre,null,r.createElement(n.code,{className:"language-java"},"import io.zenwave360.modulith.events.scs.config.EnableSpringCloudStreamEventExternalization;\r\nimport org.springframework.context.annotation.Configuration;\r\n\r\n@Configuration\r\n@EnableSpringCloudStreamEventExternalization\r\nclass ExternalizationConfiguration {\r\n}\n")),"\n",r.createElement(n.p,null,"This will route programmatically route our ",r.createElement(n.code,null,"Message<?>")," objects to the correct Spring Cloud Stream binding, but you don't need to worry about any of this as it is handled automatically behind the scenes."),"\n",r.createElement(n.pre,null,r.createElement(n.code,{className:"language-java"},'// this is some of what you get when adding @EnableSpringCloudStreamEventExternalization\r\n@AutoConfiguration\r\n@AutoConfigureAfter(EventExternalizationAutoConfiguration.class)\r\n@ConditionalOnProperty(name = "spring.modulith.events.externalization.enabled", havingValue = "true",\r\n        matchIfMissing = true)\r\npublic class MessageExternalizationConfiguration {\r\n\r\n    @Bean\r\n    EventExternalizationConfiguration eventExternalizationConfiguration() {\r\n        return EventExternalizationConfiguration.externalizing()\r\n            .select(event -> annotatedAsExternalized().test(event)\r\n                    || event instanceof Message<?> && getTarget(event) != null)\r\n            .route(Message.class, event -> RoutingTarget.forTarget(getTarget(event)).withoutKey())\r\n            .build();\r\n    }\r\n\r\n    private String getTarget(Object event) {\r\n        if (event instanceof Message<?> message) {\r\n            return message.getHeaders()\r\n                .get(SpringCloudStreamEventExternalizer.SPRING_CLOUD_STREAM_SENDTO_DESTINATION_HEADER, String.class);\r\n        }\r\n        return null;\r\n    }\r\n}\n')),"\n",r.createElement(n.h2,{id:"automagic-transactional-outbox-implementation",style:{position:"relative"}},r.createElement(n.a,{href:"#automagic-transactional-outbox-implementation","aria-label":"automagic transactional outbox implementation permalink",className:"anchor before"},r.createElement(n.div,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Automagic Transactional OutBox Implementation"),"\n",r.createElement(n.p,null,"Our original code is now ",r.createElement(n.em,null,"automagically")," implementing the Transactional OutBox pattern using Spring Modulith Events Publication Registry and Spring Cloud Stream, all made possible by the ZenWaveSDK AsyncAPI Code Generator. 🚀🚀🚀"),"\n",r.createElement(n.pre,null,r.createElement(n.code,{className:"language-java"},'@Service\r\npublic class CustomerService {\r\n    // ...\r\n\r\n    @Transactional\r\n    public Customer createCustomer(Customer input) {\r\n        log.debug("Request to save Customer: {}", input);\r\n        var customer = mapper.update(new Customer(), input);\r\n        customer = customerRepository.save(customer); // Persist to DB\r\n\r\n        var customerEvent = eventsMapper.asCustomerEvent(customer);\r\n        eventsProducer.onCustomerEvent(customerEvent); // Emit Event to external Broker via Tx OutBox\r\n        return customer;\r\n    }\r\n}\n')))}var l=function(e){void 0===e&&(e={});const{wrapper:n}=Object.assign({},(0,a.ah)(),e.components);return n?r.createElement(n,e,r.createElement(i,e)):i(e)};function s(e){let{children:n}=e;return n}function c(e){return r.createElement(s,e,r.createElement(l,e))}},48171:function(e,n,t){t.d(n,{d2:function(){return r.d},zx:function(){return c},L0:function(){return p},$s:function(){return v},VS:function(){return b},gT:function(){return E},P7:function(){return h},Gz:function(){return g},S:function(){return V},VM:function(){return S},sd:function(){return z},kW:function(){return I},$D:function(){return C},DH:function(){return k},vC:function(){return w},LR:function(){return y},Ee:function(){return H},Gh:function(){return F},Bk:function(){return j},Nm:function(){return O},rv:function(){return L.r},X_:function(){return d.X},YZ:function(){return R},vk:function(){return K},BW:function(){return N},Mo:function(){return B}});var r=t(63585),a=t(27378),o=t(87573),i=t(30294);const l=e=>{let{background:n,backgroundHover:t,on:r}=e;return()=>(0,i.ivY)(["background-color:",";color:",";&:hover:not(:disabled){background-color:",";color:",";}&:active:not(:disabled){background-color:",";color:",";}"],n,r,t,r,t,r)},s=i.ZPm.buttonBox.withConfig({displayName:"Button__InnerButton",componentId:"sc-1qxez5q-0"})(["appearance:none;border-radius:base;transition:base;font-weight:500;border:0;display:inline-flex;align-items:center;cursor:pointer;font-size:16;padding:2 3;text-decoration:none !important;&:disabled{opacity:0.5;cursor:default;}&[data-variant='primary']{","}&[data-variant='success']{","}&[data-variant='danger']{","}&[data-variant='neutral']{","}"],l({background:"primary-600",backgroundHover:"primary-700",on:"white"}),l({background:"green-600",backgroundHover:"green-700",on:"white"}),l({background:"red-600",backgroundHover:"red-700",on:"white"}),l({background:"gray-300",backgroundHover:"gray-400",on:"black"})),c=a.forwardRef(((e,n)=>{let{variant:t="primary",children:r,...i}=e;return a.createElement(o.z,{ref:n,"data-variant":t},(e=>a.createElement(s,Object.assign({},e,i),r)))}));t(23824),t(37898),t(31729);var u=t(63681),d=t(84234);const m=i.ZPm.box.withConfig({displayName:"Feature__InnerFeature",componentId:"sc-17n9iec-0"})(["border-left:1;border-left-style:dashed;border-left-color:layout-border;padding-left:4 !important;padding-right:5 !important;"]),p=a.forwardRef(((e,n)=>a.createElement(m,Object.assign({ref:n,col:{xs:1,md:1/3},px:2,pt:4,pb:{xs:2,md:5}},e)))),g=i.ZPm.h2.withConfig({displayName:"Feature__FeatureTitle",componentId:"sc-17n9iec-1"})(["margin:3 0;font-size:16;font-weight:500;border-left:1;border-color:primary-400;margin-left:",";padding-left:",";"],u.th.px(-9),u.th.px(9)),h=i.ZPm.p.withConfig({displayName:"Feature__FeatureText",componentId:"sc-17n9iec-2"})(["color:on-background-light;font-size:15;text-align:justify;margin:4 0;"]),f=i.ZPm.img.withConfig({displayName:"Feature__InnerFeatureImage",componentId:"sc-17n9iec-3"})(["margin-top:3;"]),v=a.forwardRef(((e,n)=>a.createElement(f,Object.assign({ref:n,width:48,height:48},e)))),b=a.forwardRef(((e,n)=>a.createElement(d.X,Object.assign({ref:n,row:!0,my:-4,px:3},e)))),E=a.forwardRef(((e,n)=>a.createElement(i.x.section,Object.assign({ref:n,py:4,borderTop:1,borderBottom:1,borderColor:"layout-border"},e)))),y=i.ZPm.h1Box.withConfig({displayName:"Hero__HeroTitle",componentId:"sc-18tbum5-0"})(["font-size:38;font-weight:600;line-height:1.2;letter-spacing:-1.12px;margin:0 0 2;"," ",""],(0,u.up)("md",(0,i.ivY)(["padding-top:4;font-size:48;"])),(0,u.up)("xl",(0,i.ivY)(["font-size:60;"]))),w=i.ZPm.pBox.withConfig({displayName:"Hero__HeroTeaser",componentId:"sc-18tbum5-1"})(["font-size:18;margin:3 0;"," ",""],(0,u.up)("md",(0,i.ivY)(["font-size:20;"])),(0,u.up)("xl",(0,i.ivY)(["font-size:24;"]))),x=(0,i.ZPm)(d.X).withConfig({displayName:"Hero__InnerHero",componentId:"sc-18tbum5-2"})(["background-repeat:no-repeat;background-position:top -5% center;background-size:100% auto;padding-top:65%;text-align:center;"," ",""],(0,u.up)("md",(0,i.ivY)(["padding-top:0;margin-top:5;background-position:center right;background-size:58% auto;min-height:400;text-align:left;"])),(0,u.up)("xl",(0,i.ivY)(["margin-top:6;"]))),S=a.forwardRef(((e,n)=>{let{backgroundImageURL:t,...r}=e;return a.createElement(x,Object.assign({ref:n,backgroundImage:"url("+t+")"},r))})),C=a.forwardRef(((e,n)=>a.createElement(i.x.div,Object.assign({ref:n,w:{md:.5}},e)))),k=i.ZPm.sectionBox.withConfig({displayName:"Hero__HeroSection",componentId:"sc-18tbum5-3"})(["overflow:hidden;padding-top:2;padding-bottom:5;"]),I=a.forwardRef(((e,n)=>a.createElement(i.x.div,Object.assign({ref:n,row:!0,m:-2,justifyContent:{xs:"center",md:"initial"}},e)))),z=a.forwardRef(((e,n)=>a.createElement(i.x.div,Object.assign({ref:n,col:"auto",p:2},e))));var A=t(24956);const P=i.ZPm.div.withConfig({displayName:"Image__ImageContainer",componentId:"sc-1b0134e-0"})(["text-align:",";"],(e=>e.align)),M=i.ZPm.img.withConfig({displayName:"Image__InnerImage",componentId:"sc-1b0134e-1"})(["display:inline-block;"]),T=(e,n)=>"dark"===n?e.dark||e.src:e.light||e.src,H=a.forwardRef(((e,n)=>a.createElement(P,{align:e.align||"center",className:e.visible},a.createElement(M,Object.assign({ref:n,src:T(e,(0,A.If)()[0])},e)))));t(15239),t(83160);const _=(0,i.ZPm)(i.x.cite).withConfig({displayName:"Quote__Cite",componentId:"sc-12i53kz-0"})(["display:block;text-align:right;margin-top:1rem;"]),j=a.forwardRef(((e,n)=>a.createElement(i.x.blockquote,Object.assign({ref:n,className:"quote"},e)))),O=a.forwardRef(((e,n)=>a.createElement(_,Object.assign({ref:n},e)))),N=a.forwardRef(((e,n)=>a.createElement(i.x.section,Object.assign({ref:n,py:4,borderTop:1,borderBottom:1,borderColor:"layout-border"},e)))),R=i.ZPm.divBox.withConfig({displayName:"WideFeature",componentId:"sc-1ak5yjf-0"})(["display:block;",")"],(0,u.up)("md",(0,i.ivY)(["margin:0 20px;border-top:1px dashed;border-bottom:1px dotted;border-color:var(--xstyled-colors-layout-border,#d4d4d8);display:grid;grid-template-columns:1fr 1fr 1fr;"]))),B=i.ZPm.divBox.withConfig({displayName:"WideFeature__WideFeatureText",componentId:"sc-1ak5yjf-1"})(["padding:1rem;grid-column-start:span 2;font-size:18;"," ",""],(0,u.up)("md",(0,i.ivY)(["font-size:20;padding:3rem;padding-top:2rem;"])),(0,u.up)("xl",(0,i.ivY)(["font-size:24;"]))),W=i.ZPm.divBox.withConfig({displayName:"WideFeature__WideFeatureImageContainer",componentId:"sc-1ak5yjf-2"})(["padding:1rem;text-align:center;"]),D=i.ZPm.imgBox.withConfig({displayName:"WideFeature__InnerImage",componentId:"sc-1ak5yjf-3"})(["display:inline-block;"]),Z=(e,n)=>"dark"===n?e.dark||e.src:e.light||e.src,K=a.forwardRef(((e,n)=>a.createElement(W,{className:e.className},a.createElement(D,Object.assign({ref:n,src:Z(e,(0,A.If)()[0])},e))))),V=e=>{let{gist:n,file:t}=e;const r=(0,a.useRef)(null);(0,a.useEffect)((()=>{(async()=>{const e=t?"https://gist.githubusercontent.com/"+n+"/raw/"+t:"https://gist.githubusercontent.com/"+n+"/raw";try{const n=await fetch(e);if(n.ok){const e=22*(await n.text()).split("\n").length+40;r.current&&(r.current.style.height=e+"px")}else console.error("Failed to fetch Gist content")}catch(a){console.error("Error fetching Gist content:",a)}})()}),[n,t]);const o=t?"https://gist.github.com/"+n+".pibb?file="+t:"https://gist.github.com/"+n+".pibb",i=t?"https://gist.github.com/"+n+"#file-"+t.replace(/\./g,"-").toLowerCase():"https://gist.github.com/"+n;return a.createElement("div",{style:{border:"1px solid #ccc",padding:"10px 0 0 0",borderRadius:"5px"}},t&&a.createElement("header",{style:{marginLeft:"10px",fontStyle:"oblique"}},a.createElement("span",{role:"img","aria-label":"source code"},"🗒️"),a.createElement("a",{href:i,target:"_blank",rel:"noopener noreferrer"},t)),a.createElement("iframe",{title:t,ref:r,src:o,width:"100%",frameBorder:"0",style:{margin:"0",padding:"0"}}))},F=a.forwardRef(((e,n)=>a.createElement(i.x.strong,Object.assign({ref:n,className:"orange"},e))));var L=t(29368)}}]);
//# sourceMappingURL=component---smooth-doc-src-templates-post-js-content-file-path-c-users-ivangsa-workspace-zenwave-zen-wave-360-github-io-website-pages-posts-transactional-out-box-with-async-api-and-spring-modulith-mdx-30c7e7821fecc63ccb45.js.map