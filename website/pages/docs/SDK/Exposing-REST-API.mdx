---
section: ZenWave SDK
title: Exposing a REST API
slug: /docs/zenwave-sdk/exposing-a-rest-api/
order: 8
---
import { CodeGeneration, Image, Quote, QuoteAuthor, RemoteCode } from 'smooth-doc/components'
import openapiCustomerServiceOutline from './images/openapi-customer-service-outline.png'

# Exposing a REST API for your Domain Services
Because writing YAML by hand and dealing with boilerplate code is tedious...

Thanks to ZenWave Domain Language ZDL and ZenWave SDK you can:

- Use [ZDLToOpenAPIPlugin](/zenwave-sdk/plugins/zdl-to-openapi/) to generate complete OpenAPI v3 specifications from your domain models.
- Use OpenAPI Generator Maven plugin to generate SpringMVC Controller Interfaces and DTOs from OpenAPI.
- Use [OpenAPIControllersPlugin](/zenwave-sdk/plugins/openapi-controllers/) to generate SpringMVC Controllers (skeletons) implementing OpenAPI Controller Interfaces.
- Use [SpringWebTestClientPlugin](/zenwave-sdk/plugins/openapi-spring-webtestclient/) to generate Spring WebTestClient Tests for your SpringMVC Controllers.
- use [OpenAPIKaratePlugin](/zenwave-sdk/plugins/openapi-karate/) to generate KarateDSL API Tests for your REST APIs from your OpenAPI specifications.

## ZenWave Domain Language as Interface Definition Language (IDL) for OpenAPI

Because writing YAML by hand is no fun... You can use ZDL models as Interface Definition Language (IDL) to generate OpenAPI v3 with ZenWave SDK [ZDLToOpenAPIPlugin](/zenwave-sdk/plugins/zdl-to-openapi/).

This approach allows you to:

- Define APIs using a compact, developer-friendly syntax
- Maintain consistency between your domain model and API contracts
- Consisten style between your different APIs: naming, pagination, status codes, error handling...
- Reduce manual YAML writing and potential errors

ZDL has evolved to support defining OpenAPI APIs almost completely, including file uploads and downloads, status codes, and more.

> ⚠️ **Remember**: Once generated, the OpenAPI definition becomes the source of truth for your REST API. ZDL serves as a starting point for rapid API design.

### Decorating your Services with `@rest`

First step is to decorate your services with `@rest` to indicate that they will be exposed via REST API and define the base path for all operations in this service.

```zdl
@rest("/customers")
service CustomerService for (Customer) {
    //...
}
```

Now you can use `ZDLToOpenAPIPlugin` to generate an OpenAPI definition from your ZDL model:

<RemoteCode
  summary="ZDLToOpenAPIPlugin in zenwave-scripts.zw"
  language="zdl" collapsed={false} visibleRange="6,10"
  url="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/customer-address-jpa/zenwave-scripts.zw" />

Remember that this is equivalent to running:

<RemoteCode
  summary="ZDLToOpenAPIPlugin using JBang CLI"
  language="zdl" collapsed={true}
  content={`jbang zw -p ZDLToOpenAPIPlugin \\
    zdlFile=zenwave-model.zdl \\
    idType=integer \\
    idTypeFormat=int64 \\
    targetFolder=. \\
    targetFile=src/main/resources/public/apis/openapi.yml`} />

<Image src={openapiCustomerServiceOutline} alt="OpenAPI Customer Service Outline" align={"left"}/>

### Decorating your Service Methods with `@get`, `@post`, `@put`, `@delete`, `@patch`

All `@get`, `@post`, `@put`, `@delete`, `@patch` support the following syntax:

- `@get("/somepath/{somePathParam}")`: simpler form, shorthand for `@get({path: "/somepath/{somePathParam}"})`
- `@get({path: "/somepath", status: 200, params: {search: String}, operationId: "someOperationId"})`:
  - `path`: the path for this operation, relative to the service base path.
  - `status`: the default status code for this operation, this is usefull for `@post` operations that return `200` instead of the default `201`.
  - `params`: a map of parameters and their types, they will match path params o query params if no path param was matched.
  - `operationId`: the operationId for this operation, by default it will use the service command name.

<CodeGeneration
  text1="When using the `ZDLToOpenAPIPlugin`, the following"
  sourceTitle="decorated service:" sourceLanguage="zdl" sourceVisibleRange="55,68" sourceCollapsed={false}
  sourceUrl="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/customer-address-jpa/zenwave-model.zdl"
  text2="would produce this openapi definition:"
  outputTitle="src/main/resources/public/apis/openapi.yml" outputLanguage="yaml" outputCollapsed={true}
  outputUrl="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/customer-address-jpa/src/main/resources/public/apis/openapi.yml"
/>

#### Using `@get`

As you would expect, `@get` will generate a `GET` operations, with path and query parameters defined in the `path` and `params` properties, with their corresponding data types. It will return an status code `200` by default, but you can change it using the `status` property.

<CodeGeneration
  text1="When using the `ZDLToOpenAPIPlugin`, the following"
  sourceTitle="this service command:" sourceLanguage="zdl" sourceVisibleRange="59,60" sourceCollapsed={false}
  sourceUrl="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/customer-address-jpa/zenwave-model.zdl"
  text2="would produce this:"
  outputTitle="src/main/resources/public/apis/openapi.yml" outputLanguage="yaml" outputVisibleRange="45,63" outputCollapsed={false}
  outputUrl="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/customer-address-jpa/src/main/resources/public/apis/openapi.yml"
/>

If the method command has a command payload, it will be expanded as path or query parameters.

<CodeGeneration
  text1="When using the `ZDLToOpenAPIPlugin`, the following"
  sourceTitle="this service command:" sourceLanguage="zdl" sourceVisibleRange="160,161" sourceCollapsed={false}
  sourceUrl="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/modulith-clinical-tool-jpa/models/surveys.zdl"
  text2="would produce this:"
  outputTitle="src/main/resources/public/apis/surveys-public-openapi.yml" outputLanguage="yaml" outputVisibleRange="28,55" outputCollapsed={false}
  outputUrl="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/modulith-clinical-tool-jpa/src/main/resources/public/apis/surveys-public-openapi.yml"
/>

Notice how path and query parameter data types are inferred:

- `name` path param is inferred from `SurveyByNameAndPatient.name` field type `String`.
- `patientId` path param is inferred from `SurveyByNameAndPatient.patientId` field type `Long`.
- `lang` is added as query parameter because it is not a path parameter.

#### Using `@post` for Creating Resources

Posts are used to create new resources. The default status code is `201`, if you need to change it, because you are implementing a search operation for example, you can use the `status` property.

<CodeGeneration
  text1="When using the `ZDLToOpenAPIPlugin`, the following"
  sourceTitle="this service command:" sourceLanguage="zdl" sourceVisibleRange="57,58" sourceCollapsed={false}
  sourceUrl="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/customer-address-jpa/zenwave-model.zdl"
  text2="would produce this:"
  outputTitle="src/main/resources/public/apis/openapi.yml" outputLanguage="yaml" outputVisibleRange="27,44" outputCollapsed={false}
  outputUrl="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/customer-address-jpa/src/main/resources/public/apis/openapi.yml"
/>

You can also use `@post` to implement search operations, in this case you should use `status: 200` to indicate that the operation returns a list of resources:

<CodeGeneration
  text1="When using the `ZDLToOpenAPIPlugin`, the following"
  sourceTitle="this service command:" sourceLanguage="zdl" sourceVisibleRange="54,55" sourceCollapsed={false}
  sourceUrl="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/modulith-clinical-tool-jpa/models/users.zdl"
  text2="would produce this:"
  outputTitle="src/main/resources/public/apis/openapi.yml" outputLanguage="yaml" outputVisibleRange="142,164" outputCollapsed={true}
  outputUrl="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/modulith-clinical-tool-jpa/src/main/resources/public/apis/users-openapi.yml"
/>

#### Using `@put` for Updating Resources

<CodeGeneration
  text1="When using the `ZDLToOpenAPIPlugin`, the following"
  sourceTitle="this service command:" sourceLanguage="zdl" sourceVisibleRange="61,62" sourceCollapsed={false}
  sourceUrl="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/customer-address-jpa/zenwave-model.zdl"
  text2="would produce this:"
  outputTitle="src/main/resources/public/apis/openapi.yml" outputLanguage="yaml" outputVisibleRange="64,87" outputCollapsed={false}
  outputUrl="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/customer-address-jpa/src/main/resources/public/apis/openapi.yml"
/>

#### Using `@delete` for Deleting Resources

Delete operations would return a `204` status code by default, but you can change it using the `status` property.

<CodeGeneration
  text1="When using the `ZDLToOpenAPIPlugin`, the following"
  sourceTitle="this service command:" sourceLanguage="zdl" sourceVisibleRange="63,64" sourceCollapsed={false}
  sourceUrl="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/customer-address-jpa/zenwave-model.zdl"
  text2="would produce this:"
  outputTitle="src/main/resources/public/apis/openapi.yml" outputLanguage="yaml" outputVisibleRange="88,101" outputCollapsed={false}
  outputUrl="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/customer-address-jpa/src/main/resources/public/apis/openapi.yml"
/>

#### Using `@patch` for Partial Updates

<CodeGeneration
  text1="When using the `ZDLToOpenAPIPlugin`, the following"
  sourceTitle="this service command:" sourceLanguage="zdl" sourceVisibleRange="166,167" sourceCollapsed={false}
  sourceUrl="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/modulith-clinical-tool-jpa/models/surveys.zdl"
  text2="would produce this:"
  outputTitle="src/main/resources/public/apis/surveys-public-openapi.yml" outputLanguage="yaml" outputVisibleRange="93,133" outputCollapsed={false}
  outputUrl="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/modulith-clinical-tool-jpa/src/main/resources/public/apis/surveys-public-openapi.yml"
/>

<RemoteCode
  title="#/components/schemas/SurveyAnswersPatch" sourceLanguage="yml" visibleRange="327,329" sourceCollapsed={false}
  url="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/modulith-clinical-tool-jpa/src/main/resources/public/apis/surveys-public-openapi.yml" />

<CodeGeneration
  text1="When configuring `schemaMappings` in `openapi-generator-maven-plugin` like this:"
  sourceTitle="this service command:" sourceLanguage="xml" sourceVisibleRange="394,396" sourceCollapsed={false}
  sourceUrl="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/modulith-clinical-tool-jpa/pom.xml"
  text2="will generate a java method with `Map input` as parameter:"
  outputTitle="src/main/resources/public/apis/surveys-public-openapi.yml" outputLanguage="java" outputVisibleRange="71,73" outputCollapsed={false}
  outputUrl="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/modulith-clinical-tool-jpa/src/main/java/io/zenwave360/example/clinicaltool/modules/surveys/web/SurveysApiController.java"
/>

Because `Map input` contains only the properties that where actually send by the client, you can easily implement a partial update.


### Returning Paginated Lists with `@paginated`

`ZDLToOpenAPIPlugin` supports the following pagination style out of the box when using `@paginated` annotation:

<CodeGeneration
  text1="When using the `ZDLToOpenAPIPlugin`, the following"
  sourceTitle="this `@paginated` service command:" sourceLanguage="zdl" sourceVisibleRange="65,67" sourceCollapsed={false}
  sourceUrl="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/customer-address-jpa/zenwave-model.zdl"
  text2="would produce this:"
  outputTitle="src/main/resources/public/apis/openapi.yml" outputLanguage="yaml" outputVisibleRange="102,123" outputCollapsed={false}
  outputUrl="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/customer-address-jpa/src/main/resources/public/apis/openapi.yml"
/>

With the `CustomerPaginated` schema defined as:

<RemoteCode
  title="#/components/schemas/SurveyAnswersPatch" language="yml" visibleRange="158,166" collapsed={false}
  url="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/customer-address-jpa/src/main/resources/public/apis/openapi.yml" />

And the following `components` definition:

<RemoteCode
  title="Supporting Schemas for Pagination" language="yml" visibleRange="215,264" collapsed={true}
  url="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/customer-address-jpa/src/main/resources/public/apis/openapi.yml" />

### File Uploads

`ZDLToOpenAPIPlugin` supports generating OpenAPI definitions for file upload endpoints using the `@fileupload("fieldName")` annotation being `fieldName` the name of the field in the request body that contains the file data.

<CodeGeneration
  text1="When using the `ZDLToOpenAPIPlugin`, the following"
  sourceTitle="this `@fileupload` service command:" sourceLanguage="zdl" sourceVisibleRange="40,42" sourceCollapsed={false}
  sourceUrl="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/modulith-clinical-tool-jpa/models/documents.zdl"
  text2="would produce this:"
  outputTitle="src/main/resources/public/apis/openapi.yml" outputLanguage="yaml" outputVisibleRange="88,112" outputCollapsed={false}
  outputUrl="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/modulith-clinical-tool-jpa/src/main/resources/public/apis/documents-openapi.yml"
/>

And the corresponding SpringMVC Controller:

<RemoteCode
  title="DocumentApiController.java#uploadDocument" language="yml" visibleRange="79,106" collapsed={true}
  url="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/modulith-clinical-tool-jpa/src/main/java/io/zenwave360/example/clinicaltool/modules/documents/DocumentApiController.java" />



### File Downloads

`ZDLToOpenAPIPlugin` supports generating OpenAPI definitions for file upload endpoints using the `@filedownload("javaFieldName")` annotation, being `javaFieldName` the name of the field in java model that contains the binary data to be downloaded.

<CodeGeneration
  text1="When using the `ZDLToOpenAPIPlugin`, the following"
  sourceTitle="this `@filedownload` service command:" sourceLanguage="zdl" sourceVisibleRange="36,38" sourceCollapsed={false}
  sourceUrl="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/modulith-clinical-tool-jpa/models/documents.zdl"
  text2="would produce this:"
  outputTitle="src/main/resources/public/apis/openapi.yml" outputLanguage="yaml" outputVisibleRange="45,73" outputCollapsed={false}
  outputUrl="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/modulith-clinical-tool-jpa/src/main/resources/public/apis/documents-openapi.yml"
/>

And the corresponding SpringMVC Controller:

<RemoteCode
  title="DocumentApiController.java#uploadDocument" language="java" visibleRange="60,70" collapsed={true}
  url="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/modulith-clinical-tool-jpa/src/main/java/io/zenwave360/example/clinicaltool/modules/documents/DocumentApiController.java" />



## OpenAPI Generator Maven Plugin

<RemoteCode
  title="openapi-generator-maven-plugin in pom.xml" language="xml" visibleRange="326,362" collapsed={true}
  url="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/customer-address-jpa/pom.xml" />

Important configuration properties for compatibility with `OpenAPIControllersPlugin`:

- `<useSpringBoot3>true</useSpringBoot3>` use SpringBoot 3 and jakarta annotations
- `<openApiNullable>false</openApiNullable>` we use java.util.Optional instead
- `<useOptional>false</useOptional>` do not use java.util.Optional for parameters
- `<useTags>true</useTags>` required for grouping the operations in services by tag
- `<sortParamsByRequiredFlag>false</sortParamsByRequiredFlag>` required for matching path params in generated code


### Generating SpringMVC Controller Interfaces and DTOs from OpenAPI yaml

Previous `openapi-generator-maven-plugin` will generate as part of the maven build the following java code:

- target/generated-sources/openapi/src/main/java/io/zenwave360/example/adapters/web/CustomerApi.java
- target/generated-sources/openapi/src/main/java/io/zenwave360/example/adapters/web/model/CustomerDTO.java
- target/generated-sources/openapi/src/main/java/io/zenwave360/example/adapters/web/model/AddressDTO.java
- target/generated-sources/openapi/src/main/java/io/zenwave360/example/adapters/web/model/PaymentMethodDTO.java
- target/generated-sources/openapi/src/main/java/io/zenwave360/example/adapters/web/model/PaymentMethodTypeDTO.java
- target/generated-sources/openapi/src/main/java/io/zenwave360/example/adapters/web/model/CustomerSearchCriteriaDTO.java
- target/generated-sources/openapi/src/main/java/io/zenwave360/example/adapters/web/model/CustomerPaginatedDTO.java
- target/generated-sources/openapi/src/main/java/io/zenwave360/example/adapters/web/model/PageDTO.java

These classes are part of your project compilee sources and will be compiled and packaged as part of your application. In the next section we will be implementing `CustomerApi.java` generated interface.

Do not edit this code by hand, it will be overwritten by the maven build. You will need to edit `openapi.yml` definition instead and then run maven build again, for instance:

```shell
mvn clean test-compile
```

### Generating SpringMVC Controller Implementations from OpenAPI yaml

While `openapi-generator-maven-plugin` can generate SpringMVC annotated Controller Interfaces and their DTOs, you will need to implement the interface methods yourself.

Thankfully, ZenWave SDK provides a plugin to generate SpringMVC Controller Implementations from OpenAPI yaml.

With [OpenAPIControllersPlugin](zenwave-sdk/plugins/openapi-controllers/) you can generate SpringMVC Controller Implementations from OpenAPI yaml.

<CodeGeneration
  text1="When using the `OpenAPIControllersPlugin`, the following"
  sourceTitle="this zdl script:" sourceLanguage="zdl" sourceVisibleRange="27,29" sourceCollapsed={false}
  sourceUrl="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/customer-address-jpa/zenwave-scripts.zw"
  text2="would produce this:"
  outputTitle="CustomerApiController.java" outputLanguage="java" outputVisibleRange="35,129" outputCollapsed={false}
  outputUrl="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/customer-address-jpa/src/main/java/io/zenwave360/example/adapters/web/CustomerApiController.java"
/>

And Unit Tests for your Controller:

<RemoteCode
  title="CustomerApiControllerTest.java (excerpt)" language="java" visibleRange="14,37" collapsed={true}
  url="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/customer-address-jpa/src/test/java/io/zenwave360/example/adapters/web/CustomerApiControllerTest.java" />

## Testing REST APIs

You can also generate API Tests for your REST APIs from your OpenAPI specifications.

### Generating Spring WebTestClient Tests from OpenAPI yaml

With`WebTestClient` you can test your REST API via HTTP semantics while in the same JVM process as your application.

ZenWave`SpringWebTestClientPlugin` can generate both single endpoint tests as well as business flows spanning multiple endpoints:

<CodeGeneration
  text1="When using the `SpringWebTestClientPlugin`, the following"
  sourceTitle="zenwave-scripts.zw" sourceLanguage="zdl" sourceVisibleRange="31,33" sourceCollapsed={false}
  sourceUrl="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/customer-address-jpa/zenwave-scripts.zw"
  text2="would produce this API test:"
  outputTitle="CustomerApiIntegrationTest.java (excerpt)" outputLanguage="java" outputVisibleRange="19,62" outputCollapsed={false}
  outputUrl="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/customer-address-jpa/src/test/java/io/zenwave360/example/adapters/web/CustomerApiIntegrationTest.java"
/>

<CodeGeneration
  text1="When using the `SpringWebTestClientPlugin`, the following"
  sourceTitle="zenwave-scripts.zw" sourceLanguage="zdl" sourceVisibleRange="35,40" sourceCollapsed={false}
  sourceUrl="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/customer-address-jpa/zenwave-scripts.zw"
  text2="would produce this Business Flow API test:"
  outputTitle="CustomerApiIntegrationTest" outputLanguage="java" outputCollapsed={true}
  outputUrl="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/customer-address-jpa/src/test/java/io/zenwave360/example/adapters/web/CreateUpdateDeleteCustomerIntegrationTest.java"
/>

You can control whether these are Unit or Integration Tests with `@SpringBootTest` in

<RemoteCode
  title="BaseWebTestClientTest.java"
  language="java" collapsed={true} visibleRange="14,27"
  url="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/customer-address-jpa/src/test/java/io/zenwave360/example/adapters/web/BaseWebTestClientTest.java" />


As always, it's your responsibility as the developer to provide test data and parameters that match the initial state, whether you're using a containerized database or an in-memory implementation.

### Generating KarateDSL Tests from OpenAPI yaml

You can also generate KarateDSL Tests from OpenAPI yaml. Both single endpoint tests as well as business flows spanning multiple endpoints.

<CodeGeneration
  text1="When using the `OpenAPIKaratePlugin`, the following"
  sourceTitle="zenwave-scripts.zw" sourceLanguage="zdl" sourceVisibleRange="42,44" sourceCollapsed={false}
  sourceUrl="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/customer-address-jpa/zenwave-scripts.zw"
  text2="would produce this API test:"
  outputTitle="CustomerApi.feature KarateDSL API Test" outputLanguage="gherkin" outputCollapsed={false}
  outputUrl="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/customer-address-jpa/src/test/resources/io/zenwave360/example/adapters/web/CustomerApi.feature"
/>

<CodeGeneration
  text1="When using the `OpenAPIKaratePlugin`, the following"
  sourceTitle="zenwave-scripts.zw" sourceLanguage="zdl" sourceVisibleRange="46,51" sourceCollapsed={false}
  sourceUrl="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/customer-address-jpa/zenwave-scripts.zw"
  text2="would produce this Business Flow API test:"
  outputTitle="CreateUpdateDeleteCustomerKarateTest.feature KarateDSL Business Flow Test" outputLanguage="gherkin" outputCollapsed={false}
  outputUrl="https://github.com/ZenWave360/zenwave-playground/blob/main/examples/customer-address-jpa/src/test/resources/io/zenwave360/example/adapters/web/CreateUpdateDeleteCustomerKarateTest.feature"
/>